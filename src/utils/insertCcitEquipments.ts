
import { supabase } from '@/integrations/supabase/client';

// Lista de números de série dos equipamentos CCIT 5.0
const ccitEquipments = [
  '40013', '41000', '42008', '43041', '49016', '50000', '51003', '52003', '53409',
  '40018', '41006', '42002', '43042', '49023', '50035', '51005', '52005', '53419',
  '40019', '41013', '42009', '43082', '49062', '50037', '51006', '52011', '54257',
  '40022', '41020', '42010', '43100', '49085', '50049', '51030', '52030', '54454',
  '40026', '41028', '42013', '43122', '49086', '50062', '51034', '52037', '54831',
  '40029', '41033', '42017', '43136', '49088', '50079', '51035', '52043', '54853',
  '40030', '41035', '42019', '43138', '49092', '50104', '51042', '52047', '54855',
  '40033', '41041', '42020', '43141', '49127', '50108', '51071', '52085', '54965',
  '40041', '41042', '42025', '43161', '49135', '50111', '51077', '52172', '55136',
  '40051', '41044', '42029', '43229', '49136', '50140', '51083', '52203', '55378',
  '40056', '41045', '42033', '43236', '49145', '50158', '51087', '52207', '55598',
  '40060', '41047', '42035', '43243', '49171', '50169', '51097', '52220', '55880',
  '40062', '41050', '42042', '43265', '49175', '50172', '51099', '52222', '55905',
  '40067', '41057', '42043', '43284', '49193', '50183', '51109', '52226', '55910',
  '40070', '41061', '42046', '43289', '49215', '50185', '51120', '52235', '55916',
  '40072', '41063', '42049', '43298', '49218', '50203', '51129', '52263', '55994',
  '40073', '41064', '42051', '43325', '49305', '50217', '51134', '52265', '56024',
  '40076', '41068', '42054', '43521', '49310', '50246', '51145', '52271', '56031',
  '40080', '41071', '42055', '43530', '49318', '50282', '51161', '52273', '56057',
  '40082', '41072', '42058', '43563', '49380', '50296', '51172', '52298', '56072',
  '40087', '41077', '42065', '43748', '49409', '50297', '51175', '52303', '56082',
  '40090', '41082', '42072', '43901', '49429', '50298', '51184', '52308', '56121',
  '40091', '41086', '42075', '44299', '49437', '50329', '51186', '52333', '56133',
  '40105', '41090', '42076', '44749', '49440', '50341', '51195', '52354', '56138',
  '40108', '41092', '42078', '44861', '49450', '50344', '51196', '52365', '56163',
  '40112', '41093', '42081', '44872', '49457', '50381', '51199', '52395', '56177',
  '40125', '41095', '42084', '44874', '49462', '50382', '51204', '52421', '56202',
  '40132', '41096', '42087', '44878', '49479', '50385', '51209', '52439', '56219',
  '40136', '41099', '42092', '44880', '49497', '50407', '51237', '52451', '56237',
  '40137', '41100', '42095', '44883', '49531', '50421', '51244', '52452', '56469',
  '40139', '41102', '42097', '44884', '49540', '50429', '51264', '52465', '56532',
  '40141', '41105', '42101', '44886', '49554', '50434', '51278', '52472', '56583',
  '40143', '41105', '42101', '44896', '49560', '50445', '51313', '52475', '56777',
  '40145', '41107', '42106', '44900', '49574', '50501', '51314', '52489', '56876',
  '40146', '41109', '42108', '44902', '49579', '50543', '51316', '52504', '57110',
  '40147', '41111', '42111', '44907', '49580', '50556', '51317', '52510', '57419',
  '40153', '41113', '42113', '44914', '49581', '50557', '51318', '52511', '57509',
  '40169', '41115', '42117', '44926', '49593', '50583', '51329', '52541', '57535',
  '40170', '41117', '42119', '44934', '49596', '50588', '51345', '52547', '57616',
  '40172', '41121', '42121', '44946', '49598', '50596', '51348', '52550', '57631',
  '40173', '41126', '42122', '44970', '49600', '50608', '51359', '52572', '57678',
  '40173', '41127', '42127', '44972', '49604', '50634', '51380', '52595', '57687',
  '40176', '41135', '42128', '44979', '49621', '50642', '51389', '52603', '57693',
  '40178', '41142', '42134', '44980', '49668', '50648', '51393', '52606', '57730',
  '40179', '41144', '42137', '44986', '49669', '50656', '51394', '52612', '57807',
  '40184', '41150', '42141', '45005', '49672', '50677', '51395', '52646', '57822',
  '40191', '41151', '42142', '45023', '49677', '50679', '51405', '52658', '57879',
  '40194', '41156', '42148', '45028', '49684', '50684', '51425', '52676', '57898',
  '40197', '41157', '42151', '45037', '49687', '50700', '51426', '52690', '57916',
  '40198', '41159', '42153', '45039', '49710', '50731', '51447', '52699', '57956',
  '40202', '41162', '42154', '45041', '49738', '50740', '51457', '52705', '58141',
  '40204', '41163', '42155', '45049', '49741', '50743', '51466', '52749', '58192',
  '40206', '41164', '42157', '45057', '49742', '50793', '51500', '52824', '58196',
  '40210', '41165', '42158', '45066', '49757', '50795', '51507', '52854', '58228',
  '40213', '41170', '42166', '45074', '49759', '50827', '51520', '52894', '58315',
  '40216', '41173', '42168', '45091', '49760', '50833', '51532', '52948', '58325',
  '40217', '41174', '42171', '45101', '49765', '50848', '51533', '52957', '58419',
  '40224', '41175', '42173', '45115', '49775', '50855', '51554', '59526', '58552',
  '40230', '41180', '42177', '45117', '49785', '50861', '51557', '59454', '58556',
  '40231', '41187', '42180', '45147', '49795', '50862', '51562', '59821', '58615',
  '40233', '41194', '42186', '45230', '49815', '50888', '51567', '58628',
  '40236', '41195', '42190', '45238', '49821', '50892', '51577', '58661',
  '40242', '41198', '42193', '45289', '49829', '50932', '51609', '58756',
  '40246', '41199', '42195', '45292', '49842', '50950', '51618', '58821',
  '40250', '41200', '42196', '45317', '49847', '50953', '51621', '58823',
  '40256', '41202', '42204', '45380', '49854', '50977', '51637', '58831',
  '40266', '41203', '42206', '45382', '49857', '50982', '51639', '58833',
  '40267', '41204', '42211', '45416', '49869', '41878', '51677', '58834',
  '40269', '41207', '42215', '45530', '49873', '41881', '51689', '58914',
  '40273', '41210', '42217', '45608', '49889', '41883', '51693', '58918',
  '40276', '41211', '42220', '45693', '49921', '41884', '51697', '58926',
  '40289', '41216', '42221', '46053', '49927', '41885', '51714', '58933',
  '40296', '41218', '42224', '46254', '49934', '41890', '51725', '58935',
  '40298', '41227', '42225', '46295', '49952', '41892', '51760', '58936',
  '40299', '41230', '42226', '46318', '49955', '41894', '51763',
  '40304', '41234', '42227', '46380', '49969', '41896', '51773',
  '40305', '41239', '42228', '46418', '49971', '41898', '51779',
  '40306', '41241', '42234', '46428', '49986', '41899', '51807',
  '40309', '41247', '42241', '46452', '41902', '51817',
  '40310', '41250', '42249', '47201', '41908', '51822',
  '40313', '41255', '42250', '47345', '41911', '51826',
  '40317', '41258', '42251', '47520', '41913', '51835',
  '40325', '41259', '42258', '47562', '41916', '51837',
  '40327', '41262', '42266', '47649', '41918', '51858',
  '40334', '41264', '42272', '47664', '41933', '51868',
  '40338', '41271', '42286', '47730', '41936', '51870',
  '40344', '41272', '42302', '47794', '41937', '51879',
  '40352', '41274', '42306', '47970', '41940', '51891',
  '40353', '41275', '42308', '48006', '41942', '51944',
  '40363', '41279', '42309', '48018', '41943', '51947',
  '40367', '41281', '42315', '48019', '41944', '51955',
  '40368', '41282', '42319', '48166', '41946', '51993',
  '40371', '41285', '42321', '48383', '41949',
  '40372', '41287', '42331', '48535', '41950',
  '40374', '41289', '42336', '48539', '41951',
  '40377', '41290', '42339', '48567', '41960',
  '40378', '41296', '42346', '48584', '41968',
  '40382', '41298', '42347', '48588', '41969',
  '40383', '41302', '42355', '48634', '41973',
  '40384', '41303', '42359', '48636', '41974',
  '40385', '41305', '42364', '48655', '41975',
  '40389', '41308', '42365', '48657', '41976',
  '40408', '41309', '42367', '48703', '41979',
  '40425', '41310', '42368', '48714', '41981',
  '40431', '41311', '42369', '48719', '41983',
  '40433', '41313', '42371', '48739', '41984',
  '40441', '41320', '42372', '48774', '41988',
  '40446', '41329', '42376', '48775', '41990',
  '40447', '41333', '42378', '48776', '41994',
  '40451', '41339', '42382', '48777', '41995',
  '40453', '41341', '42385', '48800', '41998',
  '40456', '41346', '42390', '48850',
  '40460', '41347', '42393', '48870',
  '40466', '41350', '42394', '48881',
  '40469', '41351', '42397', '48902',
  '40470', '41353', '42399', '48924',
  '40478', '41357', '42402', '48937',
  '40480', '41358', '42403', '48939',
  '40481', '41360', '42404', '48965',
  '40494', '41361', '42405', '48968',
  '40500', '41363', '42407', '48973',
  '40501', '41368', '42416', '48977',
  '40503', '41374', '42417',
  '40510', '41375', '42418',
  '40512', '41380', '42420',
  '40514', '41381', '42422',
  '40515', '41388', '42423',
  '40517', '41391', '42424',
  '40524', '41396', '42430',
  '40525', '41399', '42432',
  '40531', '41400', '42436',
  '40535', '41403', '42437',
  '40538', '41404', '42438',
  '40548', '41416', '42439',
  '40552', '41417', '42440',
  '40553', '41418', '42443',
  '40563', '41419', '42445',
  '40566', '41420', '42449',
  '40569', '41421', '42452',
  '40571', '41422', '42454',
  '40576', '41427', '42459',
  '40577', '41430', '42463',
  '40582', '41431', '42465',
  '40583', '41432', '42467',
  '40586', '41433', '42469',
  '40592', '41434', '42471',
  '40593', '41435', '42473',
  '40594', '41436', '42478',
  '40595', '41437', '42480',
  '40597', '41442', '42483',
  '40599', '41448', '42488',
  '40602', '41451', '42490',
  '40603', '41454', '42492',
  '40609', '41458', '42496',
  '40610', '41459', '42499',
  '40622', '41464', '42502',
  '40623', '41465', '42507',
  '40624', '41466', '42509',
  '40625', '41467', '42513',
  '40626', '41468', '42514',
  '40632', '41473', '42519',
  '40633', '41481', '42524',
  '40634', '41488', '42530',
  '40639', '41490', '42532',
  '40640', '41491', '42536',
  '40643', '41492', '42537',
  '40657', '41495', '42538',
  '40662', '41498', '42542',
  '40664', '41501', '42544',
  '40667', '41502', '42552',
  '40669', '41503', '42553',
  '40672', '41504', '42554',
  '40674', '41506', '42555',
  '40681', '41507', '42557',
  '40684', '41508', '42558',
  '40686', '41511', '42565',
  '40687', '41515', '42566',
  '40688', '41523', '42568',
  '40689', '41525', '42569',
  '40692', '41526', '42570',
  '40694', '41527', '42574',
  '40695', '41531', '42579',
  '40709', '41533', '42580',
  '40711', '41534', '42581',
  '40712', '41537', '42589',
  '40716', '41538', '42590',
  '40719', '41559', '42591',
  '40721', '41560', '42592',
  '40723', '41562', '42593',
  '40724', '41568', '42594',
  '40732', '41571', '42600',
  '40736', '41573', '42605',
  '40737', '41584', '42607',
  '40738', '41587', '42608',
  '40743', '41588', '42609',
  '40746', '41593', '42610',
  '40747', '41594', '42611',
  '40753', '41598', '42612',
  '40758', '41599', '42613',
  '40761', '41604', '42618',
  '40767', '41607', '42622',
  '40771', '41610', '42624',
  '40773', '41611', '42626',
  '40775', '41614', '42627',
  '40778', '41615', '42630',
  '40779', '41617', '42631',
  '40782', '41619', '42634',
  '40785', '41621', '42638',
  '40788', '41625', '42642',
  '40789', '41633', '42645',
  '40792', '41639', '42646',
  '40793', '41640', '42647',
  '40797', '41643', '42649',
  '40799', '41644', '42653',
  '40800', '41650', '42656',
  '40805', '41652', '42659',
  '40808', '41655', '42661',
  '40809', '41656', '42662',
  '40812', '41657', '42663',
  '40813', '41658', '42665',
  '40814', '41659', '42667',
  '40822', '41662', '42668',
  '40823', '41663', '42672',
  '40824', '41665', '42673',
  '40827', '41667', '42676',
  '40834', '41669', '42681',
  '40837', '41679', '42685',
  '40839', '41683', '42692',
  '40840', '41691', '42693',
  '40843', '41692', '42695',
  '40844', '41694', '42698',
  '40845', '41696', '42700',
  '40853', '41699', '42701',
  '40858', '41702', '42705',
  '40859', '41705', '42707',
  '40861', '41717', '42712',
  '40866', '41719', '42714',
  '40867', '41720', '42721',
  '40873', '41724', '42723',
  '40874', '41730', '42724',
  '40878', '41731', '42728',
  '40880', '41742', '42730',
  '40881', '41749', '42738',
  '40884', '41758', '42743',
  '40886', '41759', '42744',
  '40889', '41761', '42746',
  '40896', '41763', '42757',
  '40898', '41766', '42761',
  '40899', '41767', '42768',
  '40900', '41769', '42769',
  '40901', '41771', '42770',
  '40902', '41776', '42771',
  '40904', '41777', '42779',
  '40906', '41783', '42780',
  '40915', '41785', '42781',
  '40920', '41788',
  '40922', '41790',
  '40924', '41794',
  '40926', '41797',
  '40927', '41799',
  '40928', '41801',
  '40929', '41805',
  '40931', '41807',
  '40932', '41810',
  '40934', '41812',
  '40935', '41813',
  '40936', '41814',
  '40937', '41819',
  '40944', '41820',
  '40945', '41821',
  '40952', '41824',
  '40955', '41826',
  '40956', '41827',
  '40958', '41834',
  '40959', '41838',
  '40960', '41845',
  '40964', '41846',
  '40965', '41848',
  '40970', '41850',
  '40971', '41851',
  '40972', '41853',
  '40973', '41854',
  '40976', '41857',
  '40977', '41861',
  '40978', '41864',
  '40983', '41867',
  '40989', '41868',
  '40992', '41869',
  '40993', '41872'
];

export const insertCcitEquipmentsWithDuplicateCheck = async () => {
  try {
    // Busca todos os números de série existentes
    const { data: existingEquipments, error: fetchError } = await supabase
      .from('equipamentos')
      .select('numero_serie');

    if (fetchError) throw fetchError;

    const existingSerials = new Set(existingEquipments?.map(eq => eq.numero_serie) || []);
    
    // Filtra apenas os números que não existem
    const newSerials = ccitEquipments.filter(serial => !existingSerials.has(serial));
    
    if (newSerials.length === 0) {
      console.log('Todos os equipamentos já estão cadastrados');
      return { inserted: 0, duplicates: ccitEquipments.length };
    }

    // Busca a primeira empresa para usar como padrão (TACOM SISTEMAS POA)
    const { data: companies, error: companiesError } = await supabase
      .from('empresas')
      .select('id, name')
      .ilike('name', '%TACOM SISTEMAS POA%')
      .limit(1);

    if (companiesError) throw companiesError;
    
    if (!companies || companies.length === 0) {
      throw new Error('Empresa TACOM SISTEMAS POA não encontrada');
    }

    const defaultCompany = companies[0];
    const today = new Date().toISOString().split('T')[0];

    // Prepara os equipamentos para inserção
    const equipmentsToInsert = newSerials.map(serial => ({
      tipo: 'CCIT 5.0',
      numero_serie: serial,
      data_entrada: today,
      id_empresa: defaultCompany.id,
      estado: 'Rio Grande do Sul',
      status: 'disponivel'
    }));

    // Insere os equipamentos em lotes de 100
    const batchSize = 100;
    let totalInserted = 0;

    for (let i = 0; i < equipmentsToInsert.length; i += batchSize) {
      const batch = equipmentsToInsert.slice(i, i + batchSize);
      
      const { data, error } = await supabase
        .from('equipamentos')
        .insert(batch);

      if (error) throw error;
      
      totalInserted += batch.length;
      console.log(`Inserted batch ${Math.floor(i/batchSize) + 1}: ${batch.length} equipments`);
    }

    console.log(`Successfully inserted ${totalInserted} new equipments`);
    console.log(`Skipped ${ccitEquipments.length - newSerials.length} duplicates`);
    
    return { 
      inserted: totalInserted, 
      duplicates: ccitEquipments.length - newSerials.length,
      total: ccitEquipments.length
    };
  } catch (error) {
    console.error('Error inserting CCIT equipments:', error);
    throw error;
  }
};
